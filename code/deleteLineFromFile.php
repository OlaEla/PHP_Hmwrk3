<?php

/*Задача 3

Удаление строки. Когда мы научились искать,
надо научиться удалять конкретную строку.
Запросите у пользователя имя или дату для удаляемой строки.
После ввода либо удалите строку, оповестив пользователя,
либо сообщите о том, что строка не найдена.*/


$address = '/code/birthdays.txt';

// Запрашиваем у пользователя, что он хочет удалить: имя или дату
$searchTerm = readline("Введите имя или дату (ДД-ММ-ГГГГ) для удаления строки: ");

// Функция для удаления строки по имени или дате
function deleteLineFromFile($filePath, $searchTerm)
{
    // Проверяем, существует ли файл
    if (!file_exists($filePath)) {
        echo "Файл $filePath не найден!\n";
        return;
    }

    // Читаем содержимое файла в массив строк
    $lines = file($filePath, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);

    // Флаг, который определяет, было ли удаление
    $isDeleted = false;

    // Новый массив для обновленного содержимого файла
    $newLines = [];

    // Проходим по каждой строке файла
    foreach ($lines as $line) {
        // Удаляем возможные пробелы и переносы строк
        $line = trim($line);

        // Разбиваем строку по запятой, чтобы получить имя и дату
        $data = explode(", ", $line);

        // Если строка содержит имя или дату, совпадающие с поисковым запросом
        if (count($data) == 2 && ($data[0] === $searchTerm || $data[1] === $searchTerm)) {
            echo "Строка '$line' была удалена.\n";
            $isDeleted = true; // Помечаем, что удаление произошло
        } else {
            // Добавляем строку в новый массив, если она не соответствует запросу
            $newLines[] = $line;
        }
    }

    // Если строка была найдена и удалена
    if ($isDeleted) {
        // Перезаписываем файл без удалённой строки
        file_put_contents($filePath, implode(PHP_EOL, $newLines) . PHP_EOL);
    } else {
        // Если строка не найдена
        echo "Строка с именем или датой '$searchTerm' не найдена.\n";
    }
}

// Вызов функции для удаления строки из файла
deleteLineFromFile($address, $searchTerm);


